commands:
  unsupervised: null
  supervised:
    train: |-
      genhpf-preprocess-meds \
        "{dataset_dir}/data" \
        "--cohort={labels_dir}" \
        "--metadata_dir={dataset_dir}/metadata" \
        "--output_dir={output_dir}/data" \
        "--workers=32" \
        "--skip-if-exists"

      genhpf-train \
        "dataset.data={output_dir}/data" \
        "checkpoint.save_dir={output_dir}/checkpoints" \
        "common.debug={demo}" \
        "--config-dir={model_dir}" \
        "--config-name=genhpf_train"

    predict: |-
      genhpf-test \
        "dataset.data={output_dir}/data" \
        "meds.output_predictions=true" \
        "meds.labels_dir={labels_dir}" \
        "meds.output_dir={output_dir}" \
        "checkpoint.load_checkpoint={output_dir}/checkpoints/checkpoint_best.pt" \
        "dataset.test_subset={split}" \
        "common.debug={demo}" \
        "--config-dir={model_dir}" \
        "--config-name=genhpf_predict"

      mv {output_dir}/{split}.parquet {output_dir}/predictions.parquet
